<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USGS Earthquake Visualization</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin="" />

  <!-- Our CSS -->
  <style>
    body {
      padding: 0;
      margin: 0;
    }

    #map,
    body,
    html {
      height: 100%;
    }

    /* Update legend CSS */
    .info.legend i {
      border: 0.25px solid black;
      padding: 3px;
      display: inline-block;
      font-size: 14px;
      color: black; /* Font color for the legend */
    }

    /* Adjust the font color based on the background color */
    .info.legend i[style*="background: green"] {
      color: green;
    }

    .info.legend i[style*="background: blue"] {
      color: blue;
    }

    .info.legend i[style*="background: yellow"] {
      color: yellow;
    }

    .info.legend i[style*="background: orange"] {
      color: orange;
    }

    .info.legend i[style*="background: red"] {
      color: red;
    }

    .info.legend i[style*="background: purple"] {
      color: white; /* Font color for visibility on the purple background */
    }

    /* Color specifications for the markers */
    .leaflet-marker-icon.green {
      background-color: green;
      color: black; /* Font color for the marker */
    }

    .leaflet-marker-icon.blue {
      background-color: blue;
      color: white; /* Font color for visibility on the blue background */
    }

    .leaflet-marker-icon.yellow {
      background-color: yellow;
      color: black; /* Font color for the marker */
    }

    .leaflet-marker-icon.orange {
      background-color: orange;
      color: black; /* Font color for the marker */
    }

    .leaflet-marker-icon.red {
      background-color: red;
      color: white; /* Font color for visibility on the red background */
    }

    .leaflet-marker-icon.purple {
      background-color: purple;
      color: white; /* Font color for visibility on the purple background */
    }
  </style>
</head>

<body>

  <!-- The div that holds our map -->
  <div id="map" style="height: 600px;"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

  <!-- Our JavaScript -->
  <script>
    // Initialize the map
    const myMap = L.map("map", {
      center: [0, 0],
      zoom: 2,
    });

    // Add a tile layer
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(myMap);

    // Define color ranges for depth
    const depthColors = {
      19: "skyblue",
      39: "blue",
      59: "yellow",
      69: "orange",
      79: "red",
      99: "purple",
    };

    // Fetch earthquake data
    fetch("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson")
      .then((response) => response.json())
      .then((data) => {
        // Loop through the earthquake data and create markers
        data.features.forEach((feature) => {
          const magnitude = feature.properties.mag;
          const depth = feature.geometry.coordinates[2];
          const coordinates = [feature.geometry.coordinates[1], feature.geometry.coordinates[0]];
          const location = feature.properties.place; // Location information

          // Customize marker size based on magnitude
          const marker = L.circle(coordinates, {
            radius: magnitude * 50000, // Adjust the multiplier for appropriate marker size
          });

          // Set the marker color based on depth
          const color = getColorForDepth(depth);
          marker.setStyle({ fillColor: color, color: color, fillOpacity: 1 }); // Set fillOpacity to 1 for no transparency

          // Add a popup with additional information
          marker.bindPopup(
            `<strong>Magnitude:</strong> ${magnitude}<br><strong>Depth:</strong> ${depth} km<br><strong>Location:</strong> ${location}`
          );

          marker.addTo(myMap);
        });
      });

    // Create a legend
    const legend = L.control({ position: "bottomright" });

    legend.onAdd = function (map) {
      const div = L.DomUtil.create("div", "info legend");
      const labels = ['<strong>Depth</strong>'];

      // Loop through depth colors and ranges
      for (let depth in depthColors) {
        const color = depthColors[depth];
        const range = depth + "-" + (parseInt(depth) + 19) + " km";
        div.innerHTML += `<i style="background: ${color}; color: ${
          color === "purple" ? "white" : "black"
        }; border: 0.25px solid black;"></i> ${range}<br>`;
      }

      div.innerHTML += labels.join("<br>");
      return div;
    };

    legend.addTo(myMap);

    // Function to determine marker color based on depth
    function getColorForDepth(depth) {
      for (let range in depthColors) {
        if (depth <= range) {
          return depthColors[range];
        }
      }
      return "green"; // Default color for unknown depths
    }
  </script>
</body>

</html>
